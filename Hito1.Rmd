---
title: "Hito1"
author: "mineria"
date: "9/16/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
# Asignamos nuestro "working directory" (set w. d.) como el directorio ~/RDATA
setwd("~/RDATA/")
```
#Cargamos los datos

```{r}
pedidos <- read.csv("orders.csv", encoding = "UTF-8")
pedidos_detalle <-read.csv("order_detail.csv", encoding = "UTF-8")
```

#10 primeros pedidos

```{r}
head(pedidos, 20)
```

#10 primeros pedidos_detalle

```{r}
head(pedidos_detalle, 20)
```



```{r}
summary(pedidos)

```

```{R}
library(ggplot2)
```

#Exploraci칩n de datos

```{R}


library(dplyr)
pedidos_fecha <-pedidos %>%
                  mutate(created_at = substr(created_at, 1, 10))


pedidos_fecha$created_at <- as.Date(pedidos_fecha$created_at, format =  "%Y-%m-%d")
(pedidos_fecha)
```

##A continuaci칩n les dejaremos el estudio de datos sobre nuestro dataset

#A grandes razgos podemos calcular la cantidad promedio que se gasta una persona en una tienda de zapatillas
```{r}
nfilas <- nrow(pedidos_fecha)
(nfilas)
total_vendido <- sum(pedidos_fecha$current_total_price)
promedio_pedidos <- total_vendido/nfilas
(promedio_pedidos)
```


##Vamos a ver primero la cantidad de gente que pide m치s y menos que el promedio 
```{r}



#La gente que pide mas que el promedio

pedidos_RM_mayorpromedio <- data.frame(pedidos[pedidos$customer.default_address.province_code == "RM" &
                                       pedidos$current_total_price > promedio_pedidos,] )
nrow(pedidos_RM_mayorpromedio)

#La gente que pide menos que el promedio

pedidos_RM_menorpromedio <- data.frame(pedidos[pedidos$customer.default_address.province_code == "RM" &
                                       pedidos$current_total_price <= promedio_pedidos,] )
nrow(pedidos_RM_menorpromedio)

```

##El pedido mas caro en block online
```{R}

pedidos[which.max(pedidos$current_total_price),]


```
OTRO 
```{R}



pedidos_comuna <- data.frame(pedidos[pedidos$customer.default_address.province_code == "RM", ] )


ggplot(pedidos_comuna, aes(x = customer.default_address.zip ),) +
   ggtitle("Cantidad de pedidos por Comuna") +
  coord_flip() +
  geom_bar()
```


```{r}
pedidos_comuna_Lascondes <- data.frame(pedidos[pedidos$customer.default_address.zip == "LAS CONDES", ] )
(pedidos_comuna_Lascondes)
nrow(pedidos_comuna_Lascondes)
mean(pedidos_comuna_Lascondes$current_total_price)
sum(pedidos_comuna_Lascondes$current_total_price)


pedidos_comuna_puentealto <- data.frame(pedidos[pedidos$customer.default_address.zip == "PUENTE ALTO", ] )
(pedidos_comuna_puentealto)
nrow(pedidos_comuna_puentealto)
mean(pedidos_comuna_puentealto$current_total_price)
sum(pedidos_comuna_puentealto$current_total_price)


ggplot(pedidos_comuna_puentealto, aes(x = customer.default_address.zip, y = customer.total_spent ),) +
   ggtitle("Cantidad de pedidos por Comuna") +
 coord_flip() +
 geom_line()


```

xd
```{r}


ggplot(pedidos, aes(x = customer.default_address.province_code),) +
   ggtitle("Cantidad de pedidos por regi칩n") +
  geom_bar()

```


#Se deja un historial de pedidos desde el inicio del dataset hasta la ultima fecha presente
```{r}
library(ggplot2)
ggplot(pedidos_fecha, aes(x = created_at) ) +
  geom_bar() +
  scale_x_date(date_breaks = "1 month",
             date_labels = "%b") +
  labs(title = "Compras",
       x = "fecha",
       y = "Cantidad de pedidos")

```